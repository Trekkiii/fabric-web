# fabric-web

## ç‰ˆæœ¬å†å²
 
### v1.1.1

* æ–°å¢`expect`ï¼Œå…å»æ‰‹åŠ¨è¾“å…¥å¯†ç çš„çƒ¦æ¼ï¼›

### v1.1.2

* è„šæœ¬è‡ªåŠ¨åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨
* ordererå¢åŠ kafkaé›†ç¾¤
* è´¦æœ¬å­˜å‚¨ä½¿ç”¨couchdb

### v1.1.3

* æ”¯æŒåŠ¨æ€æ–°å¢ç»„ç»‡

## ä½¿ç”¨æ­¥éª¤

æˆ‘ä»¬å‡å®šæ‚¨å·²ç»é…ç½®å¥½äº†goã€dockerç¯å¢ƒï¼Œå¹¶è®¾ç½®äº†ç›¸å…³ç¯å¢ƒå˜é‡ã€‚

å¦‚æœæ²¡æœ‰ï¼Œè¯·å‚è€ƒï¼š[>> ç¯å¢ƒæ­å»º](https://github.com/hutu92/fabric-samples-cn/blob/master/README.md)

è¯·å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸ºè„šæœ¬å¢åŠ æ‰§è¡Œæƒé™ï¼š

```bash
root@vm10-249-0-4:~/fabric-web/fabric-ca# chmod +x *.sh
root@vm10-249-0-4:~/fabric-web/fabric-ca# chmod +x scripts/*.sh
root@vm10-249-0-4:~/fabric-web/fabric-ca# chmod +x scripts/eyfn/*.sh
```

### ä¸€ã€ç½‘ç»œæ‹“æ‰‘

é€šè¿‡`fabric.config`å®šä¹‰ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚

> ğŸ’¡ è¯·ç¡®è®¤`setup`èŠ‚ç‚¹çš„IPä¸ç¬¬ä¸€ä¸ªPeerç»„ç»‡çš„ç¬¬ä¸€ä¸ªpeerèŠ‚ç‚¹ä¸€è‡´ï¼Œ
> å› ä¸º`setup-bootstrap.sh`è„šæœ¬ä¼šå¯åŠ¨`run-fabric.sh`è„šæœ¬ï¼Œè€Œ`run-fabric.sh`è¿™ä¸ªè„šæœ¬æ˜¯åŸºäºè¯¥èŠ‚ç‚¹èº«ä»½æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œçš„ï¼Œ
> å¦åˆ™çš„è¯ï¼Œåœ¨æ‰§è¡Œå®ä¾‹åŒ–é“¾ç æ—¶æŠ¥`timeout`é”™è¯¯ã€‚

### äºŒã€æ„å»ºé¡¹ç›®ï¼Œæ‰“åŒ…åˆ†å‘è„šæœ¬

```bash
./network_builder.sh
```

### ä¸‰ã€ä¸‹è½½é•œåƒ

**åœ¨æ­£å¼å¼€å§‹å‰ï¼Œç¡®ä¿æ‚¨åœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ½å·²ä¸‹è½½æ‰€éœ€çš„fabricé•œåƒ**

å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä¸‹è½½é•œåƒ:

```bash
./down-images.sh
```

### å››ã€é…ç½®hosts

ä¸ºäº†é¿å…ç½‘ç»œè®¿é—®ä¸åŒçš„æƒ…å†µï¼Œè¯·ç¡®ä¿ä¿®æ”¹æ¯å°æœåŠ¡å™¨çš„`/etc/host`ï¼Œå†…å®¹å‚è§`build/host.config`ã€‚

### äº”ã€å¯åŠ¨CAæœåŠ¡

å¯¹äºæ¯ä¸€ä¸ªç»„ç»‡éƒ½è¦å¯åŠ¨ä¸€ä¸ªrcaå’ŒicaæœåŠ¡ã€‚

**ç¡®ä¿å…ˆå¯åŠ¨rcaï¼Œåœ¨å¯åŠ¨ica**ã€‚

##### (1). rca(root ca)

ä¸€ä¸ªç»„ç»‡å¯¹åº”ä¸€ä¸ª **_root fabric-ca-server_**

å¯åŠ¨æŒ‡å®šç»„ç»‡`<ORG>`çš„ **_root fabric-ca-server_** å‘½ä»¤å¦‚ä¸‹

```bash
./rca-bootstrap.sh <ORG>
```

è„šæœ¬ä¼šåœ¨Root CAåˆå§‹åŒ–æ—¶ï¼Œåœ¨`/etc/hyperledger/fabric-ca`ç›®å½•ä¸‹ç”Ÿæˆ`ca-cert.pem`è¯ä¹¦ï¼Œå¹¶å°†å…¶æ‹·è´ä¸º`/${DATA}/${ORG}-ca-cert.pem`ã€‚

##### (2). ica(intermediate ca)

ä¸€ä¸ªç»„ç»‡å¯¹åº”ä¸€ä¸ª **_intermediate fabric-ca-server_**

å¯åŠ¨æŒ‡å®šç»„ç»‡`<ORG>`çš„ **_intermediate fabric-ca-server_** å‘½ä»¤å¦‚ä¸‹

```bash
./ica-bootstrap.sh <ORG>
```

è„šæœ¬ä¼šåœ¨Intermediate CAåˆå§‹åŒ–æ—¶ï¼Œåœ¨`/etc/hyperledger/fabric-ca`ç›®å½•ä¸‹ç”Ÿæˆ`ca-chain.pem`è¯ä¹¦ï¼Œå¹¶å°†å…¶æ‹·è´ä¸º`/${DATA}/${ORG}-ca-chain.pem`ã€‚

>å…¶å®ƒèŠ‚ç‚¹ä¸‹åˆ—æ“ä½œéœ€è¦ä½¿ç”¨rca(`USE_INTERMEDIATE_CA`ä¸º`false`æ—¶)æˆ–è€…ica(`USE_INTERMEDIATE_CA`ä¸ºtrue`æ—¶)æ ¹è¯ä¹¦
     
 >
 >- å‘CAæœåŠ¡ç«¯ç”³è¯·ç»„ç»‡æ ¹è¯ä¹¦æ—¶ä½¿ç”¨;
 >- å‘CAæœåŠ¡ç«¯ç™»è®°CAç®¡ç†å‘˜èº«ä»½æ—¶ä½¿ç”¨;
 >    
 >    ä¹‹æ‰€ä»¥*ç™»è®°CAç®¡ç†å‘˜èº«ä»½*ï¼Œæ˜¯å› ä¸ºéœ€è¦ä½¿ç”¨CAç®¡ç†å‘˜èº«ä»½å»æ³¨å†ŒOrdererå’ŒPeerç›¸å…³ç”¨æˆ·å®ä½“ã€‚
 >    
 >    **_!!! æ‰§è¡Œæ³¨å†Œæ–°ç”¨æˆ·å®ä½“çš„å®¢æˆ·ç«¯å¿…é¡»å·²ç»é€šè¿‡ç™»è®°è®¤è¯ï¼Œå¹¶ä¸”æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™æ¥è¿›è¡Œæ³¨å†Œ !!!_**
 >
 >- å‘CAæœåŠ¡ç«¯ç™»è®° **_Ordererç»„ç»‡ç®¡ç†å‘˜èº«ä»½å’ŒPeerç»„ç»‡ç®¡ç†å‘˜èº«ä»½_**ã€**_OrdererèŠ‚ç‚¹èº«ä»½å’ŒPeerèŠ‚ç‚¹èº«ä»½_**ï¼Œä»¥åŠ **_Peerç»„ç»‡æ™®é€šç”¨æˆ·èº«ä»½_** æ—¶ä½¿ç”¨;
 > 
 > ç­‰ç­‰ã€‚
 
 å› æ­¤ï¼Œ
 
 - `USE_INTERMEDIATE_CA`ä¸º`false`ï¼Œå³æœªå¯ç”¨ä¸­é—´å±‚CAæ—¶ï¼Œ**_éœ€è¦å°†`/etc/hyperledger/fabric-ca/ca-cert.pem`æ‹·è´åˆ°å…¶å®ƒèŠ‚ç‚¹ä½œä¸º`CA_CHAINFILE`_**ï¼›
 - `USE_INTERMEDIATE_CA`ä¸º`true`ï¼Œå³å¯ç”¨ä¸­é—´å±‚CAæ—¶ï¼Œ**_éœ€è¦å°†`/etc/hyperledger/fabric-ca/ca-chain.pem`æ‹·è´åˆ°å…¶å®ƒèŠ‚ç‚¹ä½œä¸º`CA_CHAINFILE`_**;
 
 ä¸å¿…æ‹…å¿ƒï¼Œè¿™äº›å·¥ä½œè„šæœ¬å·²ç»å¸®æˆ‘ä»¬å®Œæˆäº†ï¼~ :laughing: 
 
 é‡‡ç”¨çš„æ–¹æ³•æ˜¯å…¶å®ƒèŠ‚ç‚¹é€šè¿‡ **_sshè¿œç¨‹æ‹·è´caä¸Šçš„æ ¹è¯ä¹¦_** ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨`fabric.config`ä¸­é…ç½®äº†CAçš„`USER_NAME`ã€`PWD`ã€`PATH`ï¼Œ
 æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜é€šè¿‡`expect`å…å»äº†ä½ ä¸è„šæœ¬äº¤äº’ï¼ˆscpè¿œç¨‹æ‹·è´éœ€è¦æ‚¨è¾“å…¥æœåŠ¡å™¨å¯†ç ï¼‰ã€‚ 
 
 åŒæ ·çš„ï¼Œ
 
 - `orderer`èŠ‚ç‚¹éœ€è¦ä»`setup`èŠ‚ç‚¹è·å–åˆ›ä¸–åŒºå—
 - `run`èŠ‚ç‚¹éœ€è¦ä»`setup`èŠ‚ç‚¹è·å–åº”ç”¨é€šé“é…ç½®äº¤æ˜“æ–‡ä»¶ã€é”šèŠ‚ç‚¹é…ç½®æ›´æ–°äº¤æ˜“æ–‡ä»¶
 
 è¿™äº›å·¥ä½œè„šæœ¬ä¹Ÿå·²ç»å¸®æˆ‘ä»¬å®Œæˆäº†ï¼~ âœŒ 
 
 ### å…­ã€å¯åŠ¨setup
 
 `setup`å®¹å™¨ç”¨äºï¼š
 
 - å‘fabric-ca-serversæ³¨å†ŒOrdererå’ŒPeerèº«ä»½
 - æ„å»ºé€šé“Artifactsï¼ˆåŒ…æ‹¬ï¼šåˆ›ä¸–åŒºå—ã€åº”ç”¨é€šé“é…ç½®äº¤æ˜“æ–‡ä»¶ã€é”šèŠ‚ç‚¹é…ç½®æ›´æ–°äº¤æ˜“æ–‡ä»¶ï¼‰
 - å¯åŠ¨`run`å®¹å™¨ï¼Œæ‰§è¡Œåˆ›å»ºåº”ç”¨é€šé“ã€åŠ å…¥åº”ç”¨é€šé“ã€æ›´æ–°é”šèŠ‚ç‚¹ã€å®‰è£…é“¾ç ã€å®ä¾‹åŒ–é“¾ç ã€æŸ¥è¯¢è°ƒç”¨é“¾ç ç­‰æ“ä½œ
 
 > åŠ¡å¿…åœ¨æ‰§è¡Œå®Œæ­¥éª¤å››ï¼Œå†æ‰§è¡Œæ­¤æ­¥éª¤ã€‚ç¡®ä¿å·²æˆåŠŸå¯åŠ¨æ‰€æœ‰ç»„ç»‡çš„`rca`ã€`ica`èŠ‚ç‚¹ã€‚
 
 ```text
 setup-bootstrap.sh [-h] [-d]
             -h|-?       è·å–æ­¤å¸®åŠ©ä¿¡æ¯
             -d          ä»ç½‘ç»œä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
 ```
 
 * è„šæœ¬éœ€è¦ä½¿ç”¨fabricçš„äºŒè¿›åˆ¶æ–‡ä»¶`configtxgen`ï¼Œè¯·å°†è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶ç½®äºPATHè·¯å¾„ä¸‹ã€‚
 
     å¦‚æœè„šæœ¬æ‰¾ä¸åˆ°ï¼Œä¼šåŸºäº[fabricæºç ](https://github.com/hyperledger/fabric)è‡ªåŠ¨ç¼–è¯‘ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ
     æ­¤æ—¶éœ€è¦ä¿è¯`$HOME/gopath/src/github.com/hyperledger/fabric`æºç å­˜åœ¨ï¼Œä¸”ç‰ˆæœ¬ä¸€è‡´ã€‚
     
     å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š`-d`é€‰é¡¹ä»ç½‘ç»œä¸‹è½½è¯¥äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå–å†³äºä½ çš„ç½‘é€Ÿã€‚
 
 * ~~è„šæœ¬éœ€è¦ä½¿ç”¨fabricçš„äºŒè¿›åˆ¶æ–‡ä»¶`fabric-ca-client`ï¼Œè¯·å°†è¯¥äºŒè¿›åˆ¶æ–‡ä»¶ç½®äºPATHè·¯å¾„ä¸‹ã€‚~~
 
     ~~å¦‚æœè„šæœ¬æ‰¾ä¸åˆ°ï¼Œä¼šåŸºäº[fabric caæºç ](https://github.com/hyperledger/fabric-ca)è‡ªåŠ¨ç¼–è¯‘ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ
     æ­¤æ—¶éœ€è¦ä¿è¯`$HOME/gopath/src/github.com/hyperledger/fabric-ca`æºç å­˜åœ¨ï¼Œä¸”ç‰ˆæœ¬ä¸€è‡´ã€‚~~
 
     ~~ç¼–è¯‘`fabric-ca`ç›¸å…³ä»£ç ï¼Œéœ€è¦ä¸€äº›ä¾èµ–åŒ…ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£…:~~
 
     ```bash
     sudo apt-get install libtool libltdl-dev
     ```
 
     ~~è„šæœ¬ä¼šå°†ç¼–è¯‘ç”Ÿæˆçš„`fabric-ca-server`å’Œ`fabric-ca-client`ä¿å­˜åœ¨`$GOPATH/bin`ç›®å½•ä¸‹ã€‚~~

 
 å¦‚æœä½ æ‰§è¡Œå®Œä¸Šè¿°ï¼Œé‚£ä¹ˆæ¥å¯åŠ¨`setup`å§ï¼~ğŸ˜
 
 > ç”±äº`setup-bootstrap.sh`è„šæœ¬çš„ä¸€äº›æ“ä½œéœ€è¦è¾ƒé«˜çš„æƒé™ï¼Œè¯·ä½¿ç”¨`root`ç”¨æˆ·è¿è¡Œã€‚
 
 ```bash
 ./setup-bootstrap.sh
 ```
 
 ### ä¸ƒã€å¯åŠ¨Zookeeperä¸Kafkaé›†ç¾¤
 
 ```text
 zk-kafka-bootstrap.sh <-z|-k> <ID>
     -h|-?       è·å–æ­¤å¸®åŠ©ä¿¡æ¯
     -z          å¯åŠ¨zookeeperèŠ‚ç‚¹
     -k          å¯åŠ¨kafkaèŠ‚ç‚¹
     <ID>        èŠ‚ç‚¹çš„ç¼–å·
 ```
 
 å‡è®¾zookeeperä¸kafkaä¸ªé…ç½®3å°ã€‚é‚£ä¹ˆå¯åŠ¨è„šæœ¬å¦‚ä¸‹ï¼š
 
 ##### (1). å¯åŠ¨Zookeeper
 
 ```bash
 ./zk-kafka-bootstrap.sh -z 1
 ./zk-kafka-bootstrap.sh -z 2
 ./zk-kafka-bootstrap.sh -z 3
 ```
 
 ##### (2). å¯åŠ¨Kafka
 
 ```bash
 ./zk-kafka-bootstrap.sh -k 1
 ./zk-kafka-bootstrap.sh -k 2
 ./zk-kafka-bootstrap.sh -k 3
 ```
 
 ### å…«ã€å¯åŠ¨orderer
 
 ```text
 orderer-bootstrap.sh [-h] <ORG> <NUM>
     -h|-?  - è·å–æ­¤å¸®åŠ©ä¿¡æ¯
     <ORG>   - å¯åŠ¨çš„ordererç»„ç»‡åç§°
     <NUM>   - å¯åŠ¨çš„ordererç»„ç»‡çš„ç¬¬å‡ ä¸ªèŠ‚ç‚¹
 ```
 
 ```bash
 ./orderer-bootstrap.sh <ORG> <NUM>
 ```
 
 ### ä¹ã€å¯åŠ¨peer
 
 ```text
 peer-bootstrap.sh [-h] <ORG> <NUM>
     -h|-?  - è·å–æ­¤å¸®åŠ©ä¿¡æ¯
     <ORG>   - å¯åŠ¨çš„peerç»„ç»‡çš„åç§°
     <NUM>   - å¯åŠ¨çš„peerç»„ç»‡çš„èŠ‚ç‚¹ç´¢å¼•
 ```
 
 ```bash
 ./peer-bootstrap.sh <ORG> <NUM>
 ```
 
 ### åã€åŠ¨æ€å¢åŠ èŠ‚ç‚¹
 
[>> åŠ¨æ€å¢åŠ èŠ‚ç‚¹](./EYFN.md)
 
 ## TODO
 
 * network_builderå¯¼è‡´é‡å†™çš„env.shï¼Œå¯¼è‡´å…¶ä¸å¯å†æ¬¡å¤ç”¨ï¼›
 * æ”¯æŒé€šè¿‡`fabric.config`é…ç½®æ˜¯å¦å¯ç”¨ä¸­é—´å±‚CAï¼›
 * åŠ¨æ€æ–°å¢ç»„ç»‡ï¼Œå¯åŠ¨Peerè°ƒç”¨é“¾ç éªŒè¯åï¼Œåº”æ¢å¤æ•°æ®è‡³åˆå§‹çŠ¶æ€ï¼Œä»¥ä¸ºåç»­å¯åŠ¨å¤šä¸ªèŠ‚ç‚¹åšå‡†å¤‡ï¼›